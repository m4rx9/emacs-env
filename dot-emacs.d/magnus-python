;; # general
(autoload 'python-mode "python-mode" "Python Mode." t)
(add-to-list 'auto-mode-alist '("\\.py\\'" . python-mode))
(add-to-list 'interpreter-mode-alist '("python" . python-mode))


;; # python-mode options
(setq
 py-python-command "ipython"
 py-indent-offset 4
 py-block-comment-prefix "##"
 py-temp-directory "/tmp"
 py-beep-if-tab-change t
 )


;; # popup
(add-to-list 'load-path "/home/magnus/.emacs.d/plugins/popup-el")
(require 'popup)

;; # pymac
(autoload 'pymacs-apply "pymacs")
(autoload 'pymacs-call "pymacs")
(autoload 'pymacs-eval "pymacs" nil t)
(autoload 'pymacs-exec "pymacs" nil t)
(autoload 'pymacs-load "pymacs" nil t)
(autoload 'pymacs-autoload "pymacs")


;; # Initialize Rope                                                                                             
(setq ropemacs-global-prefix "C-c r") ;; fix https://groups.google.com/forum/?fromgroups#!topic/rope-dev/PgLNS02hcnM
(pymacs-load "ropemacs" "rope-")
(setq ropemacs-enable-autoimport t)


;; # auto-complete
(add-to-list 'load-path "/home/magnus/.emacs.d/plugins/")
(require 'auto-complete-config)
(add-to-list 'ac-dictionary-directories "/home/magnus/.emacs.d/plugins/ac-dict")
(ac-config-default)

(setq ac-use-comphist nil)

;; # yasnippet https://github.com/capitaomorte/yasnippet
(add-to-list 'load-path
              "~/.emacs.d/plugins/yasnippet")
(require 'yasnippet)
(yas/global-mode 1)


;; # flymake
(when (load "flymake" t) 
     (defun flymake-pyflakes-init () 
       (let* ((temp-file (flymake-init-create-temp-buffer-copy 
                          'flymake-create-temp-inplace)) 
      (local-file (file-relative-name 
               temp-file 
               (file-name-directory buffer-file-name)))) 
         (list "pyflakes" (list local-file))))

    (add-to-list 'flymake-allowed-file-name-masks 
         '("\\.py\\'" flymake-pyflakes-init)))

(add-hook 'find-file-hook 'flymake-find-file-hook)


;; # flymake-cursor
;; enhancements for displaying flymake errors http://www.emacswiki.org/emacs/FlymakeCursor
(require 'flymake-cursor)


(require 'sr-speedbar)
;;(global-set-key (kbd "s-s") 'sr-speedbar-toggle)
;;(sr-speedbar-mode 1)
;;(sr-set-global-key (kbd "<f1>") "F1" 'sr-speedbar-toggle "sr-speedbar-toggle")
(global-set-key [f9] 'sr-speedbar-toggle)

;; # highlight the import pdb text; anotate pdb http://pedrokroger.com/2010/07/configuring-emacs-as-a-python-ide-2/
(defun annotate-pdb ()
  (interactive)
  (highlight-lines-matching-regexp "import pdb")
  (highlight-lines-matching-regexp "pdb.set_trace()"))
(add-hook 'python-mode-hook 'annotate-pdb)


;; # python-add-breakpoint http://pedrokroger.com/2010/07/configuring-emacs-as-a-python-ide-2/
(defun python-add-breakpoint ()
  (interactive)
  (py-newline-and-indent)
  (insert "import ipdb; ipdb.set_trace()")
  (highlight-lines-matching-regexp "^[ 	]*import ipdb; ipdb.set_trace()"))
;;(define-key py-mode-map (kbd "C-c C-b") 'python-add-breakpoint)
;;(defvar py-mode-map python-mode-map)
;;(setq py-mode-map python-mode-map)
;;(define-key python-mode-map "\t" 'python-add-breakpoint)
;;(global-define-key (kbd "C-c C-t") 'python-add-breakpoint)

;; autopair
;(require 'autopair)
;(autopair-global-mode) 

;; # fix for problem w pair mode http://lukeshu.ath.cx/1/wordpress/2011/08/fixing-wrong-type-argument-characterp-return-in-emacs/
;(add-hook 'term-mode-hook
;  #'(lambda () (setq autopair-dont-activate t)))


;; # magit
(autoload 'magit-status "magit" nil t)


;; # flymake-python https://github.com/akaihola/flymake-python
(add-to-list 'load-path "~/.emacs.d/plugins/flymake-python")

(when (load "flymake" t)
  (defun flymake-pylint-init ()
    (let* ((temp-file (flymake-init-create-temp-buffer-copy
                       'flymake-create-temp-inplace))
           (local-file (file-relative-name
                        temp-file
                        (file-name-directory buffer-file-name))))
      (list "~/.emacs.d/plugins/flymake-python/pyflymake.py" (list local-file))))
      ;;     check path

  (add-to-list 'flymake-allowed-file-name-masks
               '("\\.py\\'" flymake-pylint-init)))

(add-hook 'find-file-hook 'flymake-find-file-hook)


;; # ipython
(require 'ipython)

;; python-pylint
(require 'python-pylint)

;; python-pep8
(require 'python-pep8)


;; python-outline
(load-library "python-outline")
(setq auto-mode-alist (append '(
		("\\.texi" . texi-outline)
		("\\.py" . python-outline))
              auto-mode-alist))

